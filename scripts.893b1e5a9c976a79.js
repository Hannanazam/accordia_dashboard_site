angular.module("rt.select2",[]).value("select2Config",{}).factory("select2Stack",function(){var w=[];return{$register:function($){w.push($)},$unregister:function($){var p=w.indexOf($);-1!==p&&w.splice(p,1)},closeAll:function(){w.forEach(function($){$.close()})}}}).directive("select2",["$rootScope","$timeout","$parse","$filter","select2Config","select2Stack",function(w,$,p,P,E,V){"use strict";var T=P("filter");function y(e){var c=[];for(var v in e)e.hasOwnProperty(v)&&c.push(v);return c.sort()}var q={},_=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/;return E&&angular.extend(q,E),{require:"ngModel",priority:1,restrict:"E",template:'<input type="hidden"></input>',replace:!0,link:function(e,c,v,o){var b,f=angular.extend({},q,e.$eval(v.options)),h=angular.isDefined(v.multiple)||f.multiple;f.multiple=h,h&&(o.$isEmpty=function(i){return!i||0===i.length}),v.placeholder&&(f.placeholder=v.placeholder);var j=p(v.optionsFilter),d={};function A(i){if(j){var n=j(e);if(n)return T(i,n)}return i}if(v.s2Options){var a;if(!(a=v.s2Options.match(_)))throw new Error("Invalid s2Options encountered!");var C=p(a[2]||a[1]),I=p(a[7]),x=a[4]||a[6],G=p(a[2]?a[1]:x),g=a[5];b=function(i){d={};for(var n=A(I(e)),r=(g?y(n):n)||[],t=[],u=0;u<r.length;u++){var s={},l=u;g&&(s[g]=l=r[u]),s[x]=n[l];var O=G(e,s),S=C(e,s)||"";d[O]={id:O,text:S,obj:n[l]},t.push(d[O])}i(t)},f.query=function(i){for(var n=A(I(e)),r=(g?y(n):n)||[],t=[],u=0;u<r.length;u++){var s={},l=u;g&&(s[g]=l=r[u]),s[x]=n[l];var O=G(e,s),S=C(e,s)||"";S.toLowerCase().indexOf(i.term.toLowerCase())>-1&&t.push({id:O,text:S,obj:n[l]})}i.callback({results:t})},e.$watch(a[7],function(){o.$render()})}else{if(!f.query)throw new Error("You need to supply a query function!");var D=f.query;f.query=function(i){var n=i.callback;i.callback=function(r){for(var t=0;t<r.results.length;t++){var u=r.results[t];d[u.id]=u}n(r)},D(i)},b=function(i){f.query({term:"",callback:function(n){i(n.results)}})}}function L(i){b(h?function(n){for(var r=[],t=0;t<n.length;t++){var u=n[t];(o.$viewValue||[]).indexOf(u.id)>-1&&r.push(u)}i(r)}:function(){i(d[o.$viewValue]||{obj:{}})})}if(o.$render=function(){L(function(i){h?c.select2("data",i):c.select2("val",i.id)})},f.initSelection){var K=f.initSelection;f.initSelection=function(i,n){K(i,function(r){d[r.id]=r,n(r)})}}else f.initSelection=function(i,n){L(n)};var M={close:function(){c.select2("close")}};V.$register(M),e.$on("destroy",function(){V.$unregister(M)}),$(function(){c.select2(f),c.on("change",function(i){e.$evalAsync(function(){var n;if(h){for(var r=[],t=0;t<i.val.length;t++)(n=d[i.val[t]])&&r.push(n.id);o.$setViewValue(r)}else o.$setViewValue((n=d[i.val])?n.id:null);o.$render()})}),c.on("select2-blur",function(){o.$touched||e.$evalAsync(function(){return o.$setTouched()})}),o.$render()})}}}]);